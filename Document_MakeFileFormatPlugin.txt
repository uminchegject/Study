■ドキュメント
・処理の概要の説明
・usdGeMeshの説明

●usdGeomMesh
usdAbcにおいて、まずMeshTypeを定義しその中に必要な情報をattributeに設定していくという形で一連の処理が実装されていました。
そのため、本fileformatpluginにおいてもmeshを定義し適切なattributeに値を設定していく処理を実装していきます。
まず、usdGeomMeshの定義においてBBox,頂点座標、頂点法線、UV、面ごとの頂点数、面の頂点インデックス情報を適切なAttributeに設定する
処理を調査しました。

・faceVertexCounts, faceVertexIndicesへの設定方法
 -//surfaceの管理部分について

●fileformatplugin
・objフォーマットをusdに変換するfileformatpluginに変換するsampleがあるため、こちらも参考に実装を進めていきます。
・fileformatpluginを継承したクラス、内製フォーマットからusdに変換するクラスの2つで構成されているため、本実装でも同じように実装していく予定です。


■usdAbc
●usdAbcPluginでReadした際のMeshの構造

・int[] faceVertexCounts
・int[] faceVertexIndices
・point3f[] points

・float3[] extent
面のboundbox
{
	
}

・uniform token orientation
・uniform token subdivisionScheme

・custom string[] primvars:shop_materialpath
・custom uint[] primvars:shop_materialpath:indices
・uniform token subsetFamily:materialBind:familyType

・texCoord2f[] primvars:st
・int[] primvars:st:indices


・matrix4d xformOp:transform
・uniform token[] xformOpOrder

●処理
static
void
_ReadPolyMesh(_PrimReaderContext* context)
{
    typedef IPolyMesh Type;

    // Wrap the object.
    if (!Type::matches(context->GetObject().getHeader())) {
        // Not of type Type.
        return;
    }

    // Set prim type.
    context->GetPrim().typeName = UsdAbcPrimTypeNames->Mesh;

    // Add child properties under schema.
    context->SetSchema(Type::schema_type::info_type::defaultName());

    // Add properties.
    context->AddProperty(
        UsdGeomTokens->points,
        SdfValueTypeNames->Point3fArray,
        _CopyGeneric<IP3fArrayProperty, GfVec3f>(
            context->ExtractSchema("P"), kNoMatching));
    context->AddProperty(
        UsdGeomTokens->velocities,
        SdfValueTypeNames->Vector3fArray,
        _CopyGeneric<IV3fArrayProperty, GfVec3f>(
            context->ExtractSchema(".velocities")));
    context->AddProperty(
        UsdGeomTokens->normals,
        SdfValueTypeNames->Normal3fArray,
        _CopyGeneric<IN3fGeomParam, GfVec3f>(
            context->ExtractSchema("N")));
    context->AddProperty(
        UsdGeomTokens->faceVertexIndices,
        SdfValueTypeNames->IntArray,
        _CopyGeneric<IInt32ArrayProperty, int>(
            context->ExtractSchema(".faceIndices")));
    context->AddProperty(
        UsdGeomTokens->faceVertexCounts,
        SdfValueTypeNames->IntArray,
        _CopyGeneric<IInt32ArrayProperty, int>(
            context->ExtractSchema(".faceCounts")));

    // Read texture coordinates
    _ReadProperty<IV2fGeomParam, GfVec2f>(context, "uv", _GetUVPropertyName(), _GetUVTypeName());

    // Custom subdivisionScheme property.  Alembic doesn't have this since
    // the Alembic schema is PolyMesh.  Usd needs "none" as the scheme.
    context->AddUniformProperty(
        UsdGeomTokens->subdivisionScheme,
        SdfValueTypeNames->Token,
        _CopySynthetic(UsdGeomTokens->none));
}

■△Kitchen_set
●構造
・asset.usd
・asset_payload.usd
ペイロードを挟む
・asset_geom.usd
データ本体

●asset_geom.usdのMesh構造
・float3[] extent
・custom bool isAsset
・float[] primvars:__faceindex
・

■△Davinci
●構造


■参考資料
・Kitchen_set
https://zenn.dev/remiria/articles/7514e41f89a887b33730#%E3%82%B3%E3%83%B3%E3%83%9D%E3%82%B8%E3%82%B7%E3%83%A7%E3%83%B3
https://zenn.dev/remiria/articles/9af685611d77b60e80d7

・usdMeshGeom
https://qiita.com/snowxcrash/items/4e6e58e13c04dafc5749
https://github.com/ft-lab/Documents_USD/blob/master/doc/usd_create_mesh.md